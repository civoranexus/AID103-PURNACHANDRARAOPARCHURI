<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Photo Capture Module - CropGuard AI</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
    font-family:Segoe UI,Tahoma;
    background:linear-gradient(135deg,#142C52,#16808D);
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px
}

.container{
    background:#fff;
    border-radius:15px;
    box-shadow:0 20px 60px rgba(0,0,0,.3);
    max-width:800px;
    width:100%;
    overflow:hidden
}

.header{
    background:linear-gradient(135deg,#1B9AAA,#16808D);
    color:#fff;
    padding:30px;
    text-align:center
}

.content{padding:30px}
.section{margin-bottom:30px}

.section-title{
    font-size:18px;
    font-weight:600;
    margin-bottom:15px;
    display:flex;
    gap:10px;
    align-items:center
}

.section-title::before{
    content:'';
    width:4px;height:20px;
    background:#1B9AAA;
    border-radius:2px
}

.camera-container{
    border:2px dashed #1B9AAA;
    border-radius:10px;
    overflow:hidden;
    background:#f8f9ff
}

#cameraFeed{
    width:100%;
    height:400px;
    display:none;
    object-fit:cover;
    background:black
}

.camera-placeholder{
    height:400px;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#666;
    font-size:24px
}

.button-group{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin:15px 0
}

button{
    flex:1;
    padding:12px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:600
}

.btn-primary{background:#1B9AAA;color:white}
.btn-secondary{background:#eee}
.btn-danger{background:#ff6b6b;color:white}
.btn-success{background:#51cf66;color:white}

.preview-container{
    display:none;
    border:2px solid #1B9AAA;
    padding:20px;
    border-radius:10px
}

.preview-container.active{display:block}

#photoPreview{
    width:100%;
    max-height:400px;
    border-radius:8px
}

.crop-controls{display:none;margin-top:15px}
.crop-controls.active{display:block}

input[type=range]{width:100%}

.status-message{
    display:none;
    padding:15px;
    border-radius:8px;
    margin-bottom:15px
}

.status-message.show{display:block}
.status-message.success{background:#d4edda;color:#155724}
.status-message.error{background:#f8d7da;color:#721c24}
.status-message.info{background:#d1ecf1;color:#0c5460}

.upload-progress{display:none;margin-bottom:15px}
.upload-progress.active{display:block}

.progress-bar{
    height:8px;
    background:#ddd;
    border-radius:4px;
    overflow:hidden
}

.progress-fill{
    height:100%;
    width:0%;
    background:#1B9AAA
}
</style>
</head>

<body>

<div class="container">
<div class="header">
<h1>ðŸ“¸ Photo Capture Module</h1>
<p>CropGuard AI Image Capture</p>
</div>

<div class="content">

<div id="statusMessage" class="status-message"></div>

<div class="section">
<div class="section-title">Camera</div>

<div class="button-group">
<button id="startCameraBtn" class="btn-primary">Start Camera</button>
<button id="stopCameraBtn" class="btn-secondary" disabled>Stop Camera</button>
<button id="captureBtn" class="btn-success" disabled>Capture</button>
</div>

<div class="camera-container">
<video id="cameraFeed" playsinline></video>
<div id="cameraPlaceholder" class="camera-placeholder">ðŸ“· Camera Off</div>
</div>
</div>

<div class="section">
<div class="section-title">Upload Image</div>
<input type="file" id="fileInput" accept="image/*">
</div>

<div id="previewContainer" class="preview-container">
<img id="photoPreview">
</div>

<div id="cropControls" class="crop-controls">
<label>Brightness</label>
<input type="range" id="brightness" min="0" max="200" value="100">

<label>Contrast</label>
<input type="range" id="contrast" min="0" max="200" value="100">

<label>Saturation</label>
<input type="range" id="saturation" min="0" max="200" value="100">
</div>

<div id="uploadProgress" class="upload-progress">
<div class="progress-bar">
<div id="progressFill" class="progress-fill"></div>
</div>
</div>

<div class="button-group">
<button id="uploadBtn" class="btn-primary" disabled>Upload</button>
<button id="clearBtn" class="btn-danger">Clear</button>
</div>

</div>
</div>

<script>
class PhotoCaptureModule {
    constructor(){
        this.stream=null;
        this.image=null;

        this.cameraFeed=cameraFeed;
        this.startCameraBtn=startCameraBtn;
        this.stopCameraBtn=stopCameraBtn;
        this.captureBtn=captureBtn;
        this.fileInput=fileInput;
        this.previewContainer=previewContainer;
        this.photoPreview=photoPreview;
        this.uploadBtn=uploadBtn;
        this.clearBtn=clearBtn;
        this.statusMessage=statusMessage;
        this.uploadProgress=uploadProgress;
        this.progressFill=progressFill;

        this.init();
    }

    init(){
        this.startCameraBtn.onclick=()=>this.startCamera();
        this.stopCameraBtn.onclick=()=>this.stopCamera();
        this.captureBtn.onclick=()=>this.capturePhoto();
        this.fileInput.onchange=e=>this.loadFile(e.target.files[0]);
        this.uploadBtn.onclick=()=>this.uploadDemo();
        this.clearBtn.onclick=()=>this.clearAll();

        ['brightness','contrast','saturation'].forEach(id=>{
            document.getElementById(id).oninput=()=>this.applyFilters();
        });
    }

    async startCamera(){
        try{
            this.stream=await navigator.mediaDevices.getUserMedia({video:true});
            this.cameraFeed.srcObject=this.stream;
            await this.cameraFeed.play();

            this.cameraFeed.style.display='block';
            cameraPlaceholder.style.display='none';
            this.captureBtn.disabled=false;
            this.stopCameraBtn.disabled=false;
            this.startCameraBtn.disabled=true;

            this.showStatus("Camera started","success");
        }catch(e){
            this.showStatus(e.message,"error");
        }
    }

    stopCamera(){
        this.stream?.getTracks().forEach(t=>t.stop());
        this.cameraFeed.style.display='none';
        cameraPlaceholder.style.display='flex';
        this.startCameraBtn.disabled=false;
        this.captureBtn.disabled=true;
        this.stopCameraBtn.disabled=true;
    }

    capturePhoto(){
        const c=document.createElement('canvas');
        c.width=this.cameraFeed.videoWidth;
        c.height=this.cameraFeed.videoHeight;
        c.getContext('2d').drawImage(this.cameraFeed,0,0);
        this.image=c.toDataURL('image/jpeg');
        this.showPreview(this.image);
    }

    loadFile(file){
        const r=new FileReader();
        r.onload=e=>{
            this.image=e.target.result;
            this.showPreview(this.image);
        };
        r.readAsDataURL(file);
    }

    showPreview(src){
        this.photoPreview.src=src;
        this.previewContainer.classList.add('active');
        cropControls.classList.add('active');
        this.uploadBtn.disabled=false;
    }

    applyFilters(){
        this.photoPreview.style.filter=
        `brightness(${brightness.value}%)
         contrast(${contrast.value}%)
         saturate(${saturation.value}%)`;
    }

    async uploadDemo(){
        this.uploadProgress.classList.add('active');
        for(let i=0;i<=100;i+=20){
            this.progressFill.style.width=i+'%';
            await new Promise(r=>setTimeout(r,100));
        }
        this.uploadProgress.classList.remove('active');
        this.showStatus("Image uploaded (demo)","success");
    }

    clearAll(){
        this.previewContainer.classList.remove('active');
        cropControls.classList.remove('active');
        this.uploadBtn.disabled=true;
        this.showStatus("Cleared","info");
    }

    showStatus(msg,type){
        this.statusMessage.textContent=msg;
        this.statusMessage.className=`status-message ${type} show`;
        setTimeout(()=>this.statusMessage.classList.remove('show'),3000);
    }
}

document.addEventListener('DOMContentLoaded',()=>new PhotoCaptureModule());
</script>

</body>
</html>
